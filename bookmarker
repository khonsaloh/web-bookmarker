#!/bin/sh

urlfile=~/.local/share/base
delimiter='-'
default_se='https://www.google.com/search?q='
#default_se='https://duckduckgo.com/?q='
#default_se='https://www.startpage.com/do/dsearch?query='
#default_se='https://www.bing.com/search?q='

[ -n "$1" ] && case $1 in
	-a|-add) printf '%s' "pon nombre del marcador: " && read -r nombre \
		&& printf '%s' "pon url: " && read -r url && echo "$nombre $delimiter $url" >> $urlfile;;
	-d|-r) for gon in "$(fzf --cycle --reverse --prompt='eliminar entrada: ' -m < $urlfile)"; do
		sed -i /"$gon"/d "$urlfile" 2>/dev/null
	done;;
	-e|e) "$EDITOR" "$urlfile" ;;
	-h|--help|*) printf "opciones son:\\n-add\\n-d (delete entry)\\n-e (edit bookmark file)\\n";;
esac

[ -n "$1" ] && exit

urls=$(grep -v '^#' $urlfile | dmenu -i -l 20 -sb '#898818' -p 'marcadores web:') || exit

if [ -n "$(echo $urls | grep "$delimiter")" ]; then 
	url=$(printf '%s\n' "$urls" | cut -d"$delimiter" -f2- |cut -c 2- |tr ' ' '+') 
	pidof -q "$BROWSER" && "$BROWSER" "$url" || setsid -f "$BROWSER" "$url"
else
	url=$(printf '%s\n' "$urls" |tr ' ' '+') 
	pidof -q "$BROWSER" && "$BROWSER" "$default_se$url" \
		|| setsid -f "$BROWSER" "$default_se$url"
fi
